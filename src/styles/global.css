html,
body {
  height: 100%;
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

/* Progress Bar */
.progress-bar {
  position: fixed;
  left: 0;
  top: 0;
  height: 5px;
  background-color: #3b82f6;
  z-index: 50;
  transition: width 0.3s ease-out;
}

:root {
  --bg-color: #f5f5f5;
  --text-color: #333333;
  --paper-bg: #ffffff;
  --line-color: #a6ffed;
  --margin-color: rgba(255, 85, 91, 0.8);
  --margin-ghost-color: rgba(255, 85, 91, 0.2);
}

body {
  margin: 0;
  padding: 0;
  height: 100%;
  background-color: var(--paper-bg);
  background-image:
    linear-gradient(
      to right,
      var(--margin-ghost-color),
      var(--margin-ghost-color)
    ),
    linear-gradient(to right, var(--margin-color), var(--margin-color)),
    linear-gradient(
      to bottom,
      var(--paper-bg) 0px,
      var(--paper-bg) 69px,
      rgba(255, 255, 255, 0) 70px
    ),
    repeating-linear-gradient(
      var(--paper-bg) 0px,
      var(--paper-bg) 18px,
      var(--line-color) 19px,
      var(--paper-bg) 20px
    );
  background-size:
    1px,
    1px,
    auto,
    auto 20px;
  background-repeat: repeat-y, repeat-y, no-repeat, repeat;
  background-position:
    90% 0px,
    10% 0px,
    0px 0px,
    0px 0px;
}

.paper {
  margin: 0;
  display: block;
  font:
    10pt Arial,
    sans-serif;
  line-height: 20px;
  padding-top: 50px;
  padding-left: 10.5%;
  padding-right: 10.5%;
  padding-bottom: 100px;
  text-align: justify;
}
.paper:first-line {
  font:
    20pt Arial,
    sans-serif;
  line-height: 33px;
  vertical-align: baseline;
}
.paper:after {
  content: '';
  display: block;
  width: 20px;
  height: 20px;
  border-radius: 10px;
  position: absolute;
  background: rgba(255, 255, 255, 1);
  top: 40px;
  left: 2%;
  z-index: 10;
  -webkit-box-shadow:
    inset 2px 2px 5px rgba(125, 125, 125, 1),
    2px 50.1em 5px rgba(255, 255, 255, 1),
    0px 50em rgba(125, 125, 125, 0.75),
    2px 90.1em 5px rgba(255, 255, 255, 1),
    0px 90em rgba(125, 125, 125, 0.5),
    2px 130.1em 5px rgba(255, 255, 255, 1),
    0px 130em rgba(125, 125, 125, 0.25);
  -moz-box-shadow:
    inset 2px 2px 5px rgba(125, 125, 125, 1),
    2px 50.1em 5px rgba(255, 255, 255, 1),
    0px 50em rgba(125, 125, 125, 0.75),
    2px 90.1em 5px rgba(255, 255, 255, 1),
    0px 90em rgba(125, 125, 125, 0.5),
    2px 130.1em 5px rgba(255, 255, 255, 1),
    0px 130em rgba(125, 125, 125, 0.25);
  box-shadow:
    inset 2px 2px 5px rgba(125, 125, 125, 1),
    2px 50.1em 5px rgba(255, 255, 255, 1),
    0px 50em rgba(125, 125, 125, 0.75),
    2px 90.1em 5px rgba(255, 255, 255, 1),
    0px 90em rgba(125, 125, 125, 0.5),
    2px 130.1em 5px rgba(255, 255, 255, 1),
    0px 130em rgba(125, 125, 125, 0.25);
}

.paper:focus {
  outline: none;
}

/* Markdown Styles */
.paper h1,
.paper h2,
.paper h3,
.paper h4,
.paper h5,
.paper h6 {
  margin-top: 40px;
  margin-bottom: 20px;
  font-weight: bold;
  line-height: 1.3;
}

.paper h1 {
  font-size: 28pt;
  line-height: 40px;
  border-bottom: 2px solid #a6ffed;
  padding-bottom: 10px;
}

.paper h2 {
  font-size: 22pt;
  line-height: 40px;
  border-bottom: 1px solid #a6ffed;
  padding-bottom: 8px;
}

.paper h3 {
  font-size: 18pt;
  line-height: 20px;
}

.paper h4 {
  font-size: 14pt;
  line-height: 20px;
}

.paper h5,
.paper h6 {
  font-size: 12pt;
  line-height: 20px;
}

.paper p {
  margin: 20px 0;
}

.paper a {
  color: #0066cc;
  text-decoration: underline;
}

.paper a:hover {
  color: #0052a3;
}

/* Wiki-Link Styles */
.paper .wiki-link {
  color: #3b82f6 !important;
  text-decoration: none !important;
  border-bottom: 2px solid rgba(59, 130, 246, 0.3);
  padding-bottom: 1px;
  background: rgba(59, 130, 246, 0.05);
  padding: 0 4px;
  border-radius: 4px;
  transition: all 0.2s;
}

.paper .wiki-link:hover {
  background: rgba(59, 130, 246, 0.1);
  border-bottom-color: #3b82f6;
}

.paper .wiki-link.broken-link {
  color: #ef4444 !important;
  border-bottom-color: rgba(239, 68, 68, 0.3);
  background: rgba(239, 68, 68, 0.05);
  animation: wikiLinkShake 0.4s cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
}

@keyframes wikiLinkShake {
  10%,
  90% {
    transform: translate3d(-1px, 0, 0);
  }
  20%,
  80% {
    transform: translate3d(2px, 0, 0);
  }
  30%,
  50%,
  70% {
    transform: translate3d(-4px, 0, 0);
  }
  40%,
  60% {
    transform: translate3d(4px, 0, 0);
  }
}

.paper strong {
  font-weight: bold;
}

.paper em {
  font-style: italic;
}

.paper code {
  background-color: #f4f4f4;
  padding: 2px 6px;
  border-radius: 3px;
  font-family: 'Courier New', Courier, monospace;
  font-size: 9pt;
}

.paper pre {
  background-color: #f4f4f4;
  padding: 15px;
  border-radius: 5px;
  overflow-x: auto;
  margin: 20px 0;
  line-height: 20px;
}

.paper pre code {
  background-color: transparent;
  padding: 0;
  font-size: 9pt;
}

.paper blockquote {
  border-left: 4px solid #a6ffed;
  padding-left: 15px;
  margin: 20px 0;
  color: #555;
  font-style: italic;
}

.paper ul,
.paper ol {
  margin: 20px 0;
  padding-left: 30px;
}

.paper ul {
  list-style-type: disc;
}

.paper ol {
  list-style-type: decimal;
}

.paper li {
  margin: 10px 0;
  line-height: 20px;
}

.paper img {
  max-width: 100%;
  height: auto;
  margin: 20px 0;
  border-radius: 5px;
}

.paper hr {
  border: none;
  border-top: 2px solid #a6ffed;
  margin: 40px 0;
}

.paper table {
  border-collapse: collapse;
  width: 100%;
  margin: 20px 0;
}

.paper table th,
.paper table td {
  border: 1px solid #ddd;
  padding: 8px;
  text-align: left;
  line-height: 20px;
}

.paper table th {
  background-color: #f4f4f4;
  font-weight: bold;
}

.paper table tr:nth-child(even) {
  background-color: #f9f9f9;
}

/* Bottom Navbar */
.bottom-navbar {
  position: fixed;
  bottom: 2rem;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  border: 1px solid rgba(0, 0, 0, 0.1);
  border-radius: 9999px;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 6px;
  padding: 8px 16px;
  z-index: 2000;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Paper Themes State */
body[data-paper-theme='classic'] {
  --paper-bg: #ffffff;
}
body[data-paper-theme='sepia'] {
  --paper-bg: #f4ecd8;
  --text-color: #5d4037;
  --line-color: rgba(93, 64, 55, 0.1);
  --margin-color: rgba(183, 28, 28, 0.3);
  --margin-ghost-color: rgba(183, 28, 28, 0.1);
}
body[data-paper-theme='graph'] {
  --paper-bg: #ffffff;
  --line-color: rgba(33, 150, 243, 0.15);
}
body[data-paper-theme='blueprint'] {
  --paper-bg: #004b87;
  --text-color: #ffffff;
  --line-color: rgba(100, 210, 255, 0.2);
  --margin-color: rgba(100, 210, 255, 0.4);
  --margin-ghost-color: rgba(100, 210, 255, 0.1);
}

body[data-paper-theme='journal'] {
  --paper-bg: rgba(255, 255, 255, 0.4);
  --text-color: #333333;
  --line-color: rgba(0, 0, 0, 0.1);
  --margin-color: rgba(255, 0, 0, 0.3);
  --margin-ghost-color: rgba(255, 0, 0, 0.1);
}

.gallery-button {
  background-color: #4db6ac;
  color: white;
}

.gallery-button:hover {
  background-color: #00897b;
}

.paper {
  background-color: transparent; /* Let body background show through */
  margin: 0;
  display: block;
  font:
    10pt Arial,
    sans-serif;
  line-height: 20px;
  padding-top: 50px;
  padding-left: 10.5%;
  padding-right: 10.5%;
  padding-bottom: 9rem;
  text-align: justify;
  position: relative;
}

/* Vintage theme parchment effect */
body[data-paper-theme='sepia'] .paper::before {
  content: '';
  position: absolute;
  inset: 0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
  opacity: 0.05;
  pointer-events: none;
  z-index: -1;
}

/* Scientific (Graph) theme specific pattern on paper */
body[data-paper-theme='graph'] .paper::before {
  content: '';
  position: absolute;
  inset: 0;
  background-image:
    linear-gradient(rgba(33, 150, 243, 0.2) 1px, transparent 1px),
    linear-gradient(90deg, rgba(33, 150, 243, 0.2) 1px, transparent 1px);
  background-size: 20px 20px;
  pointer-events: none;
  z-index: -1;
}

/* Blueprint theme specific grid on paper */
body[data-paper-theme='blueprint'] .paper::before {
  content: '';
  position: absolute;
  inset: 0;
  background-image:
    linear-gradient(rgba(255, 255, 255, 0.1) 1px, transparent 1px),
    linear-gradient(90deg, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
  background-size: 40px 40px;
  pointer-events: none;
  z-index: -1;
}

/* Journal theme specific styles */
body[data-paper-theme='journal'] {
  background-image: none; /* Disable default lines as we'll use user's specific ones */
  background-color: #f0ede9; /* A slightly paper-like background */
}

body[data-paper-theme='journal'] .paper {
  background-color: rgba(255, 255, 255, 0.4);
  font-family: 'Shadows Into Light', cursive;
  font-size: 20px;
  line-height: 26px;
  letter-spacing: 1px;
  word-spacing: 4px;
  padding-left: 90px;
  padding-top: 40px;
}

body[data-paper-theme='journal'] .paper::before {
  content: '';
  width: 1px;
  height: 100%;
  position: absolute;
  top: 0;
  left: 60px;
  background-color: rgba(255, 0, 0, 0.4);
  z-index: 1;
}

body[data-paper-theme='journal'] .paper::after {
  content: '';
  width: 1px;
  height: 100%;
  position: absolute;
  top: 0;
  left: 63px;
  background-color: rgba(255, 0, 0, 0.4);
  z-index: 1;
}

/* Journal lines */
body[data-paper-theme='journal'] .paper {
  background-image: repeating-linear-gradient(
    rgba(255, 255, 255, 0.4) 0px,
    rgba(255, 255, 255, 0.4) 25px,
    rgba(0, 0, 0, 0.1) 26px
  );
  background-size: 100% 26px;
  background-attachment: local;
}

.nav-btn,
.switch-button {
  background: transparent;
  color: #666;
  border: none;
  border-radius: 50%;
  width: 44px;
  height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.25s ease;
  padding: 0;
  text-decoration: none;
  position: relative;
}

.nav-btn:hover,
.switch-button:hover {
  background: rgba(0, 0, 0, 0.05);
  color: #000;
  transform: scale(1.05);
}

.nav-btn:active,
.switch-button:active {
  transform: scale(0.95);
}

.nav-btn svg,
.switch-button svg {
  width: 22px;
  height: 22px;
  stroke: currentColor;
  stroke-width: 2;
  transition: all 0.2s;
}

/* Standalone Scroll Top Button */
.scroll-top-btn-standalone {
  position: fixed;
  bottom: 6.5rem;
  right: 2rem;
  width: 44px;
  height: 44px;
  background: rgba(255, 255, 255, 0.9);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border: 1px solid rgba(0, 0, 0, 0.1);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  z-index: 2000;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
  color: #666;
  opacity: 0;
  visibility: hidden;
  transform: translateY(10px);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.scroll-top-btn-standalone:hover {
  background: #fff;
  color: #000;
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
}

.scroll-top-btn-standalone:active {
  transform: translateY(0) scale(0.95);
}

.scroll-top-btn-standalone.visible {
  opacity: 1;
  visibility: visible;
  transform: translateY(0);
}

.scroll-top-btn-standalone svg {
  width: 22px;
  height: 22px;
  stroke: currentColor;
  stroke-width: 2;
}

@media (max-width: 768px) {
  .scroll-top-btn-standalone {
    bottom: 5rem;
    right: 1rem;
    width: 40px;
    height: 40px;
  }
}

/* RTL Support */
.paper[dir='rtl'] {
  text-align: right;
  direction: rtl;
}

.paper[dir='rtl'] ul,
.paper[dir='rtl'] ol {
  padding-right: 30px;
  padding-left: 0;
}

.paper[dir='rtl'] blockquote {
  border-left: none;
  border-right: 4px solid #a6ffed;
  padding-left: 0;
  padding-right: 15px;
}

/* Modal Styles */
.modal-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
  z-index: 3000;
  overflow-y: auto;
  padding: 20px 0;
  box-sizing: border-box;
}

.modal-overlay[style*='display: flex'] {
  display: flex !important;
  align-items: center;
  justify-content: center;
}

.modal {
  background-color: rgba(255, 255, 255, 0.85);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border: 1px solid rgba(255, 255, 255, 0.3);
  border-radius: 24px;
  padding: 32px;
  max-width: 440px;
  width: 90%;
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
  text-align: center;
  max-height: calc(100vh - 60px);
  margin: auto;
  position: relative;
  display: flex;
  flex-direction: column;
  box-sizing: border-box;
  animation: modalScaleUp 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes modalScaleUp {
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

.modal.info-modal {
  max-width: 650px;
}

.modal h2 {
  margin: 0 0 24px 0;
  font-size: 20px;
  font-weight: 700;
  color: #111;
  flex-shrink: 0;
  letter-spacing: -0.01em;
}

.modal-content {
  flex: 1;
  overflow-y: auto;
  text-align: left;
  padding-right: 5px;
  margin-bottom: 25px;
}

/* Custom scrollbar for modal-content */
.modal-content::-webkit-scrollbar {
  width: 6px;
}

.modal-content::-webkit-scrollbar-track {
  background: transparent;
}

.modal-content::-webkit-scrollbar-thumb {
  background: rgba(0, 0, 0, 0.1);
  border-radius: 3px;
}

:global(body[data-theme='dark']) .modal-content::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.1);
}

.modal-buttons {
  display: flex;
  gap: 15px;
  justify-content: center;
  flex-shrink: 0;
}

.modal-btn {
  padding: 12px 32px;
  border: none;
  border-radius: 9999px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

.modal-btn:active {
  transform: scale(0.96);
}

.modal-btn:hover {
  opacity: 0.8;
}

.modal-cancel {
  background-color: rgba(0, 0, 0, 0.05);
  color: #666;
}

.modal-cancel:hover {
  background-color: rgba(0, 0, 0, 0.08);
  color: #333;
}

.modal-confirm {
  background-color: #333;
  color: white;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.modal-confirm:hover {
  background-color: #000;
  transform: translateY(-1px);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
}

/* Modal Custom Elements */
.modal-label {
  display: block;
  text-align: left;
  font-size: 0.85rem;
  font-weight: 600;
  color: #666;
  margin-bottom: 8px;
  margin-left: 12px;
}

.modal-input {
  width: 100%;
  padding: 12px 20px;
  background: rgba(0, 0, 0, 0.03);
  border: 1px solid rgba(0, 0, 0, 0.05);
  border-radius: 9999px;
  font-family: inherit;
  font-size: 1rem;
  color: #333;
  box-sizing: border-box;
  transition: all 0.2s;
  margin-bottom: 20px;
}

.modal-input:focus {
  outline: none;
  background: rgba(255, 255, 255, 0.9);
  border-color: rgba(0, 0, 0, 0.1);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
}

.modal-desc {
  font-size: 0.9rem;
  color: #666;
  margin-bottom: 24px;
  line-height: 1.5;
}

/* Theme Toggle Button */
.theme-toggle {
  background-color: #333;
  color: white;
  border: none;
  border-radius: 9999px;
  padding: 10px 20px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
}

.theme-toggle:hover {
  background-color: #000;
  transform: translateY(-1px);
}

/* Reset Button Width override removed as it's now a pill button */

/* Mobile Responsive */
@media (max-width: 768px) {
  .paper {
    padding-bottom: 10rem;
    padding-left: 12%;
    padding-right: 12%;
  }

  /* Ensure all content stays within bounds */
  .paper pre {
    overflow-x: auto;
    max-width: 100%;
    word-wrap: break-word;
    white-space: pre-wrap;
  }

  .paper code {
    word-wrap: break-word;
    word-break: break-word;
  }

  .paper h1,
  .paper h2,
  .paper h3,
  .paper h4,
  .paper h5,
  .paper h6 {
    word-wrap: break-word;
  }

  .paper p,
  .paper li,
  .paper blockquote {
    word-wrap: break-word;
  }

  .paper table {
    display: block;
    overflow-x: auto;
    width: 100%;
  }

  .bottom-navbar {
    bottom: 1rem;
    padding: 6px 16px;
    gap: 4px;
    width: auto;
    max-width: 90%;
  }

  .nav-btn,
  .switch-button {
    width: 40px;
    height: 40px;
  }

  .nav-btn svg,
  .switch-button svg {
    width: 20px;
    height: 20px;
  }

  .modal {
    padding: 20px;
    max-height: 85vh;
  }

  .modal-overlay {
    align-items: flex-start;
    padding: 20px;
  }

  .modal.info-modal {
    width: 95%;
  }
}

/* Markdown Toolbar Styles */
.markdown-toolbar {
  position: fixed;
  top: 80px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(0, 0, 0, 0.1);
  border-radius: 50px;
  padding: 6px 16px;
  display: flex;
  gap: 4px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  z-index: 2500;
  transition: all 0.3s ease;
}

.markdown-toolbar button {
  background: transparent;
  border: none;
  border-radius: 50%;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  color: #555;
  transition: all 0.2s;
}

.markdown-toolbar button:hover {
  background: rgba(0, 0, 0, 0.05);
  color: #000;
}

.markdown-toolbar .separator {
  width: 1px;
  background: rgba(0, 0, 0, 0.1);
  margin: 4px;
}

@media (max-width: 768px) {
  .markdown-toolbar {
    top: auto;
    bottom: 8rem;
    padding: 4px 12px;
    width: auto;
    max-width: 90%;
    overflow-x: auto;
  }

  .markdown-toolbar button {
    width: 28px;
    height: 28px;
  }
}
